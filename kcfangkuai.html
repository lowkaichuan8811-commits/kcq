<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信视频下载工具 - 网页版</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        input[type="text"] {
            width: 80%;
            max-width: 600px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #status {
            margin-top: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>微信聊天视频下载工具</h1>
    <p>粘贴微信视频链接，然后点击下载。注意：仅适用于可公开访问的链接，微信链接可能有时效性或CORS限制。如果下载失败，请检查URL是否有效或尝试使用代理。</p>
    <input type="text" id="videoUrl" placeholder="输入微信视频URL" required>
    <button onclick="downloadVideo()">下载视频</button>
    <div id="status"></div>

    <script>
        async function downloadVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const status = document.getElementById('status');
            
            if (!url) {
                status.textContent = '请提供有效的URL';
                return;
            }

            status.textContent = '正在下载...';

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors', // 尝试处理CORS，但微信可能不允许
                    credentials: 'omit'
                });

                if (!response.ok) {
                    throw new Error('网络响应失败: ' + response.statusText);
                }

                const blob = await response.blob();
                const filename = url.split('/').pop() || 'video.mp4';

                // 创建下载链接
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = downloadUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                document.body.removeChild(a);

                status.textContent = '下载完成！';
            } catch (error) {
                status.textContent = '下载失败: ' + error.message + '。可能的原因：CORS限制、URL失效或需要认证。请尝试在浏览器中直接打开URL下载，或使用后端代理工具。';
            }
        }
    </script>
</body>
</html>
